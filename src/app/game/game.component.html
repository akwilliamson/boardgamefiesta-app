<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <ul class="navbar-nav">
    <li class="nav-item"><a class="btn btn-secondary" [routerLink]="['/']">Back</a></li>
  </ul>

  <div *ngIf="state | async as state">
    <ul class="navbar-nav">
      <li class="nav-item" *ngIf="state.turn">
        <button class="btn btn-secondary" (click)="endTurn()">End Turn</button>
      </li>
      <li class="nav-item" *ngIf="state.turn">
        Your Turn ({{state.expires | fromNow}} remaining)
      </li>

      <li class="nav-item" *ngIf="!state.turn">
        waiting for {{state.currentPlayer.user.username}} ({{state.expires | fromNow}} remaining)
      </li>
    </ul>
  </div>


  <form class="form-inline">
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm">
          <app-connection-status></app-connection-status>
        </div>
      </div>
    </div>
  </form>
</nav>

<ng-container *ngIf="game | async as game">
  <ng-container *ngIf="game.status === 'STARTED'; else notStarted">
    <app-board [game]="game"
               [state]="state | async"
               (action)="perform($event)">
    </app-board>
  </ng-container>

  <ng-template #notStarted>
    <!-- TODO Confirm dialog when not all players have accepted -->
    <button class="btn btn-primary" *ngIf="game.startable" (click)="start()">Start</button>

    <ul>
      <li>{{game.currentPlayer.username}}</li>
      <li *ngFor="let player of game.otherPlayers">
        {{player.user.username}}
        {{player.status}}
      </li>
    </ul>
  </ng-template>
</ng-container>
