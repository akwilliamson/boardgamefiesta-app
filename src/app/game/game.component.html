<nav class="bg-dark container-fluid">
  <div class="row">
    <div class="col-3">
      <a class="btn btn-secondary" [routerLink]="['/']">Back</a>
    </div>

    <div class="col-6">
      <div *ngIf="state | async as state">
        <ul class="navbar-nav">
          <li class="nav-item" *ngIf="state.turn">
            <button class="btn btn-secondary" (click)="endTurn()">End Turn</button>
          </li>
          <li class="nav-item" *ngIf="state.turn">
            Your Turn ({{state.expires | fromNow:1000}} remaining)
          </li>

          <li class="nav-item" *ngIf="!state.turn">
            waiting for {{state.currentPlayer.user.username}} ({{state.expires | fromNow:1000}} remaining)
          </li>
        </ul>
      </div>
    </div>

    <div class="col-3">
      <app-connection-status></app-connection-status>
    </div>
  </div>
</nav>

<ng-container *ngIf="game | async as game">
  <ng-container *ngIf="game.status === 'STARTED'; else notStarted">
    <app-board [game]="game"
               [state]="state | async"
               (action)="perform($event)">
    </app-board>
  </ng-container>

  <ng-template #notStarted>
    <!-- TODO Confirm dialog when not all players have accepted -->
    <button class="btn btn-primary" *ngIf="game.startable" (click)="start()">Start</button>

    <ul>
      <li>{{game.currentPlayer.username}}</li>
      <li *ngFor="let player of game.otherPlayers">
        {{player.user.username}}
        {{player.status}}
      </li>
    </ul>
  </ng-template>
</ng-container>
