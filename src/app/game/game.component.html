<nav class="navbar navbar-expand-lg fixed-top bg-dark justify-content-between">
  <ul class="navbar-nav">
    <li class="nav-item">
      <a class="btn btn-secondary" [routerLink]="['/']">{{'back'|translate}}</a>
    </li>
    <ng-container *ngIf="state | async as state">
      <li class="nav-item">
        <a class="btn btn-primary" *ngIf="state.turn" (click)="endTurn()">{{'endTurn'|translate}}</a>
        <button class="btn btn-secondary" *ngIf="canSkip(state)" (click)="skipAction()">{{'skip'|translate}}</button>
      </li>
    </ng-container>
  </ul>

  <ng-container *ngIf="state | async as state">
    <div class="actions">
      <ng-container *ngIf="!selectedAction">
        <ng-container *ngIf="!isAuxActions(state)">
          <span *ngFor="let actionType of state.actions" [ngSwitch]="actionType">
              <button *ngSwitchDefault
                      class="btn btn-secondary" (click)="selectAction(actionType)"
                      ngbPopover="{{'action.' + actionType | translate}}"
                      placement="bottom"
                      triggers="mouseenter:mouseleave"
                      container="body">{{actionType}}</button>
          </span>
        </ng-container>
        <ng-container *ngIf="isAuxActions(state)">
          <!-- Aux actions can be selected on player board, no need to show them here -->
          Select auxiliary action on player board
        </ng-container>
      </ng-container>

      <ng-container *ngIf="selectedAction">
        {{'action.' + selectedAction | translate}}
        <button class="btn btn-secondary" *ngIf="state.actions.length > 1" (click)="cancelAction()">Cancel</button>
      </ng-container>
    </div>

    <div class="form-inline">
      <div *ngIf="state.turn">
        {{'yourTurn' |translate}} ({{state.expires | fromNow}} {{'remaining'|translate}})
      </div>
      <div *ngIf="!state.turn">
        waiting for {{state.currentPlayer.user ? state.currentPlayer.user.username : 'Computer'}} ({{state.currentPlayer.color}}) ({{state.expires | fromNow}} remaining)
      </div>
      <app-connection-status></app-connection-status>
    </div>
  </ng-container>
</nav>

<div class="main" *ngIf="game | async as game">
  <ng-container *ngIf="game.status === 'STARTED' || game.status === 'ENDED'">
    <app-board [game]="game"
               [state]="state | async"
               [selectedAction]="selectedAction"
               (action)="perform($event)"
               (selectAction)="selectAction($event)">
    </app-board>
  </ng-container>

  <ng-container *ngIf="game.status === 'NEW'">
    {{game.status}}

    <button class="btn btn-primary" [disabled]="!game.startable" (click)="start()">Start</button>
    <span *ngIf="!game.startable">You cannot start the game</span>
    <span *ngIf="game.startable">You can start the game (even if not all players have accepted)</span>

    <ul>
      <li *ngFor="let player of game.otherPlayers">
        {{player.user ? player.user.username : 'Computer'}}
        {{player.status}}
      </li>
    </ul>
  </ng-container>
</div>
